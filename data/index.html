<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QO-100 LNB/PA Controller — v018.6</title>
  <link rel="stylesheet" href="/style.css?v=0186">
</head>
<body>
  <!-- MODALE MELDING -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal__dialog">
      <div class="modal__header">
        <h3 id="modalTitle">Melding</h3>
        <button id="modalClose" class="modal__close" aria-label="Close">×</button>
      </div>
      <div id="modalBody" class="modal__body">...</div>
      <div class="modal__footer">
        <button id="modalOk" class="btn primary">OK</button>
      </div>
    </div>
  </div>

  <header class="header">
    <h1>QO-100 LNB/PA Controller</h1>
    <p id="utcTime" class="clock">UTC: …</p>
  </header>

  <main class="main">
    <!-- METER -->
    <section class="card">
      <div class="gauge-wrapper">
        <img id="gaugeImage" class="gauge-bg" src="/meter-satpwr.png" alt="Gauge"/>
        <svg id="gaugeOverlay" class="gauge-overlay">
          <rect id="needleForward"  x="0" width="2" />
          <rect id="needleReflected" x="0" width="2" />
        </svg>
      </div>

      <div class="metrics-row">
        <div id="forwardBox"   class="meter-box">FOR: 0.0 W</div>
        <div id="reflectedBox" class="meter-box">REF: 0.0 W</div>
        <div id="swrBox"       class="meter-box swr-green">SWR: 1.00</div>
        <div id="tempBox"      class="meter-box">TEMP: 25.0°C</div>
      </div>

      <!-- Spanningsrij -->
      <div class="metrics-row">
        <div id="v5Box"  class="meter-box">5V: 0.00 V</div>
        <div id="v12Box" class="meter-box">12V: 0.00 V</div>
        <div id="v18Box" class="meter-box">18V: 0.00 V</div>
        <div id="v28Box" class="meter-box">28V: 0.00 V</div>
      </div>
    </section>

    <!-- CONTROLS -->
    <section class="card controls">
      <div class="control">
        <span>MAIN PA</span>
        <button id="mainPaToggle" class="btn danger">OFF</button>
      </div>
      <div class="control">
        <span>MODE</span>
        <button id="togglePol" class="btn success">SSB</button>
      </div>
      <div class="control">
        <span>WS-CON</span>
        <span class="ws-dot" id="wsStatusDot"></span>
      </div>
      <div class="control">
        <button id="settingsToggle" class="btn secondary">SETTINGS</button>
      </div>
      <div class="control">
        <button id="simToggle" class="btn secondary">REAL</button>
      </div>
      <div class="control">
        <button id="otaToggle" class="btn secondary">OTA UPDATE</button>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settingsPanel" class="card hidden">
      <h2>Instellingen</h2>
      <div class="form-grid">
        <label>Forward Max (W)
          <input type="number" id="forwardMax" step="1" min="1" value="50">
        </label>
        <label>Reflected Max (W)
          <input type="number" id="reflectedMax" step="1" min="1" value="25">
        </label>
        <label>Naald kleur
          <input type="color" id="needleColor" value="#ff0000">
        </label>
        <label>Naald dikte (px)
          <input type="number" id="needleThickness" min="1" max="255" value="6">
        </label>
        <label>SWR drempel (PA OFF)
          <input type="number" id="swrThreshold" step="0.1" min="1.5" max="10" value="3.5">
        </label>
      </div>

      <h3>Kalibratie spanningsmeting</h3>
      <div class="form-grid">
        <label>5V factor (Vin = Vadc × k)
          <input type="number" id="v5Scale" step="0.0001" value="1.6818">
        </label>
        <label>12V factor
          <input type="number" id="v12Scale" step="0.0001" value="4.0909">
        </label>
        <label>18V factor
          <input type="number" id="v18Scale" step="0.0001" value="6.4545">
        </label>
        <label>28V factor
          <input type="number" id="v28Scale" step="0.0001" value="10.0909">
        </label>
      </div>

      <div class="row">
        <button id="applySettings" class="btn success">Apply</button>
        <button id="saveSettings"  class="btn primary">Save</button>
        <button id="reloadSettings" class="btn">Reload</button>
      </div>
    </section>

    <!-- OTA -->
    <section id="otaPanel" class="card hidden">
      <h2>OTA Update</h2>
      <div class="row">
        <button id="checkUpdate" class="btn">Check for update</button>
      </div>
      <div class="row">
        <label class="file">
          <input type="file" id="otaFile" accept=".bin,.bin.gz,.bin.zip"/>
          <span>Kies firmware (.bin)</span>
        </label>
        <button id="doUpdate" class="btn primary">Upload & Flash</button>
      </div>
      <div id="otaProgress" class="progress hidden">
        <div id="otaProgressFill"></div>
      </div>
      <p class="hint">Tip: gebruik een gecompileerde .bin (Sketch → Export Compiled Binary).</p>
    </section>
  </main>

  <footer class="footer">
    <p id="firmwareVersion">Firmware Version: Loading… — PA0ESH</p>
  </footer>

  <script src="/script.js?v=0186"></script>
</body>
</html>
