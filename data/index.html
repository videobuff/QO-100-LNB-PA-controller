<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>QO-100 LNB/PA Controller</title>
  <link rel="stylesheet" href="/style.css?v=024"/>
</head>
<body>
  <!-- vaste alert laag -->
  <div id="alert-stack"></div>

  <header class="site-header">
    <h1>QO-100 LNB/PA Controller</h1>
    <p class="clock-text" id="utcTime">UTC: Loading…</p>
  </header>

  <main class="container">
    <!-- Gauge -->
    <div class="gauge-wrapper">
      <img src="/meter-satpwr.png" alt="Gauge" id="gaugeImage" class="gauge-bg"/>
      <svg id="gaugeOverlay" class="gauge-overlay">
        <rect id="needleForward"   x="0" y="30"  width="2" height="80" fill="#000000"/>
        <rect id="needleReflected" x="0" y="190" width="2" height="80" fill="#000000"/>
      </svg>
    </div>

    <!-- Metrics rij -->
    <div class="row metrics">
      <div id="forwardBox"   class="meter-box">FOR: 0.0 W</div>
      <div id="reflectedBox" class="meter-box">REF: 0.0 W</div>
      <div id="swrBox"       class="meter-box swr-box swr-ok">SWR: 1.00</div>
      <div id="tempBox"      class="meter-box">TEMP: 25.0°C</div>
    </div>

    <!-- Rails metrics (verschijnt alleen als firmware 'rails' meestuurt) -->
    <div class="row metrics" id="railsRow" style="display:none;">
      <div id="rail5Box"  class="meter-box">5V: –.– V</div>
      <div id="rail12Box" class="meter-box">12V: –.– V</div>
      <div id="rail18Box" class="meter-box">18V: –.– V</div>
      <div id="rail28Box" class="meter-box">28V: –.– V</div>
    </div>

    <!-- Controls rij -->
    <div class="row controls">
      <div class="control">
        <span>MAIN PA</span>
        <button id="mainPaToggle" class="btn">OFF</button>
      </div>
      <div class="control">
        <span>MODE</span>
        <button id="togglePol" class="btn">SSB</button>
      </div>
      <div class="control">
        <span>SIM</span>
        <button id="simToggle" class="btn">SIM</button>
      </div>
      <div class="control">
        <span>WS-CON</span>
        <span class="dot" id="wsStatusDot" style="background:#999"></span>
      </div>
      <div class="control">
        <button class="btn btn-secondary" onclick="toggleSettings()">SETTINGS</button>
      </div>
      <div class="control">
        <button class="btn btn-secondary" onclick="toggleOtaForm()">OTA UPDATE</button>
      </div>
    </div>

    <!-- Settings -->
    <section id="settingsForm" class="card" style="display:none;">
      <h2>Settings</h2>
      <div class="grid-2">
        <label>Forward Max (W)<input type="number" id="forwardMax" value="50" step="1" min="1"/></label>
        <label>Reflected Max (W)<input type="number" id="reflectedMax" value="25" step="1" min="1"/></label>
        <label>Needle Color<input type="color"  id="needleColor" value="#000000"/></label>
        <label>Needle Thickness (px)<input type="number" id="needleThickness" value="2" min="1" max="255"/></label>
        <label>SWR Threshold<input type="number" id="swrThreshold" value="3" step="0.1" min="1.5" max="10"/></label>

        <label>5V scale<input  type="number" id="v5Scale"  step="0.0001"/></label>
        <label>12V scale<input type="number" id="v12Scale" step="0.0001"/></label>
        <label>18V scale<input type="number" id="v18Scale" step="0.0001"/></label>
        <label>28V scale<input type="number" id="v28Scale" step="0.0001"/></label>
      </div>

      <div class="row actions">
        <button id="saveSettingsButton"  class="btn btn-primary">Save</button>
        <button id="applySettingsButton" class="btn btn-success">Apply (local)</button>
      </div>
    </section>

    <!-- OTA -->
    <section id="otaForm" class="card" style="display:none;">
      <h2>OTA Update</h2>
      <div class="row">
        <button class="btn btn-primary" onclick="checkForUpdate()">Check for Update</button>
      </div>
      <label>OTA URL<input type="text" id="otaUrl" placeholder="https://…/firmware.bin"/></label>
      <div class="row actions">
        <button class="btn btn-success" onclick="performUpdate()">Update</button>
        <button class="btn btn-secondary" onclick="hideOtaProgress()">Hide progress</button>
      </div>
      <div id="otaProgress" class="progress" style="display:none;">
        <div id="otaProgressBarFill"></div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p id="firmwareVersion">Firmware Version: Loading… — PA0ESH</p>
  </footer>

  <script src="/script.js?v=024"></script>
</body>
</html>
